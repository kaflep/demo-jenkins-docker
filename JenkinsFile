pipeline {
  agent any
    //docker{
      //image 'indeshwar/docker-maven'
      //args '--user root -v /var/run/docker.sock:/var/run/docker.sock' // mount Docker socket to access the host's Docker daemon
    //}

  stages {
    stage('Compile and clean') {
      steps{
        sh "mvn clean compile"
      }
      stage('deploy'){
        steps {
          sh "mvn package"
        }
    }

    stage('Build Docker image'){
        steps{
                sh 'docker build -t pkafle/app:${BUIDL_NUMBER} .' 
        }
    }
    stage('Docker deploy') {
      steps {
          sh 'docker run -itd -p 8083:8080 pkafle/app:${BUILD_NUMBER}'
      }
  }

    stage("Push docker image to Dockerhub"){
        steps{
            script{
                withCredentials([string(credentialsId: 'DockerId', variable: 'dockerpwd')]) {
                    sh 'docker login -u pkafle -p ${dockerpwd}'
                    sh 'docker push pkafle/app:${BUILD_NUMBER}'
                }

            }
        }
    }
  }
}
